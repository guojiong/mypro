{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>出库查询</title>
  <!-- DataTables -->
{% endblock title %}
<link rel="stylesheet" href="{% static 'AdminLTE/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css' %}">
{% block navheader %}
<section class="content-header">
	<h1 style="height: 0px">
	出库查询
	<small>Control panel</small>
	</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> 出库查询</a></li>
	</ol>
</section>
{% endblock navheader %}

{% block content %}
<section class="content">
	<div class="row">
		<div class="box">
			<div class="box-header">
				<form class="form-horizontal">
					<div class="box-body">
						<div class="form-group col-sm-4">
							<label for="project_c" class="col-sm-4 control-label">材料编号：</label>
							<div class="col-sm-8">
								<input type="text" class="form-control" id="project_c" placeholder="项目编号">
							</div>
						</div>
						<div class="form-group col-sm-4">
							<label for="project_n" class="col-sm-4 control-label">材料名称：</label>
							<div class="col-sm-8">
								<input type="text" class="form-control" id="project_n" placeholder="项目名称">
							</div>
						</div>
						<div class="form-group col-sm-4">
							<button type="button" class="btn btn-default col-sm-3" onclick="javascript:query();">查询</button>
							<span class="col-sm-1"></span>
							<button type="reset" class="btn btn-default col-sm-3">重置</button>
						</div>
             			</div>
					<!-- /.box-body -->
				</form>
			</div>
			<div class="box-body" style="height: 100%">
				<table id="store_table" class="table table-bordered table-hover">
					<thead>
						<tr>
							<th style="width: 90px">出库日期</th>
							<th class="col-lg-1">出库单号</th>
							<th class="col-lg-1" style="width: 115px">材料类别 > 小类</th>
							<!-- <th class="col-lg-1">材料小类</th> -->
							<th>材料名称</th>
							<th class="col-lg-1" style="width: 115px">品牌/规格/型号</th>
							<th>数量</th>
							<th>单位</th>
							<th>出库去向</th>
							<th>领用人</th>
							<th>所属项目</th>
							<th>备注</th>
						</tr>
					</thead>
					<tbody>
						{% for store in outstores %}
							<tr>
								<td class="text-green text-bold">{{ store.date|date:"Y-m-d" }}</td>
								<td>{{ store.outNo }}</td>
								<td>{{ store.store.mtype }} > {{ store.store.mclass }}</td>
								<!-- <td>{{ store.mclass }}</td> -->
								<td>{{ store.store.mname }}</td>
								<td>{{ store.store.specifi }}</td>
								<td>{{ store.num }}</td>
								<td>{% if store.unit %}{{ store.unit }}{% endif %}</td>
								<td>{{ store.toWhere }}</td>
								<td>{{ store.receiver }}</td>
								<td>{{ store.store.project.name }}</td>
								<td>{% if store.remark %}{{ store.remark }}{% endif %}</td>
							</tr>
							{% empty %}
							<tr>没有数据！</tr>
					  	{% endfor %}
				  	</tbody>
				</table>
			</div>
		</div>
	</div>
</section>

{% endblock content %}

{% block js %}
<!-- DataTables -->
<script src="{% static 'AdminLTE/bower_components/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'AdminLTE/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>
<script>
	$(function () {
		$('#store_table').DataTable({
		      'paging'      : true,
		      'lengthChange': false,
		      'searching'   : false,
		      'ordering'    : true,
		      'info'        : true,
		      'autoWidth'   : false,
		    })
    })
    function trim(str){   
    	return str.replace(/^(\s|\u00A0)+/,'').replace(/(\s|\u00A0)+$/,'');   
	}
    function query(){
		var code = trim($('input#project_c')[0].value);
		var name = trim($('input#project_n')[0].value);
		data = {csrfmiddlewaretoken:'{{csrf_token}}',}
		if (code!=''){
			data['code']=code;
		}
		if (name!=''){
			data['name']=name;
		}
		$.ajax({
			url:"{% url 'project:query' %}",
			type:'POST',
			async : false, 
			data:data,
			success: function (data) {
				$('tbody').html(data);
 			},
		});
	}
    
</script>
{% endblock js %}